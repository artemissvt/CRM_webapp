{% extends "base_manager.html" %}
{% block title %}View Employee{% endblock %}

{% block content %}

<div class="container-xl mt-4">


<!-- Centered Dashboard title -->
<div class="d-flex justify-content-center mb-4">
    <div class="activity-header-box">
        <h1 class="admin-dashboard-title">View Employee</h1>
    </div>
</div>

    </div>

<!-- Search bar -->
        <form method="get" class="admin-search mb-3">
            <div class="input-group">
                <span class="input-group-text admin-search-icon">üîç</span>
                <input
                    type="text"
                    class="form-control admin-search-input"
                    name="q"
                    placeholder="Search for employee"
                    value="{{ q or '' }}"
                >
            </div>
        </form>
<div class="d-flex flex-column gap-4">

  <div class="row g-4">
    <!-- General Employee Info -->
    <div class="col-md-6">
      <div class="activity-card">
        <div class="activity-card-header">General Employee Info</div>

        <div class="activity-card-body">
          <div class="activity-row">
            <span>Total employees</span><span>: {{ stats.total_empl }}</span>
          </div>
          <div class="activity-row">
            <span>Total customers</span><span>: {{ stats.total_cus }}</span>
          </div>
          <div class="activity-row">
            <span>Total contacts</span><span>: {{ stats.total_cont }}</span>
          </div>
          <div class="activity-row">
            <span>Average contacts per employee</span><span>: {{ stats.average_cont }}</span>
          </div>
          <div class="activity-row">
            <span>Top employee</span><span>: {{ stats.top_employee_name }}</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Contacts per Employee this month (bars) -->
    <div class="col-md-6">
      <div class="activity-card">
        <div class="activity-card-header">Contacts per Employee this month</div>

        <div class="activity-card-body">
          {# stats.month_contacts should be a list of dicts: [{"name": "...", "count": 48}, ...] #}
          {% set max_val = (stats.month_contacts | map(attribute='count') | max) if stats.month_contacts else 1 %}

          <div class="bars">
            {% for item in stats.month_contacts %}
              {% set pct = (item.count / max_val * 100) %}
              <div class="bar-row">
                <div class="bar-name">{{ item.name }}</div>

                <div class="bar-track" aria-label="contacts bar">
                  <!--<div class="bar-fill" style="width: {{ pct }}%;"></div>-->
                </div>

                <div class="bar-value">{{ item.count }}</div>
              </div>
            {% endfor %}
          </div>

          {% if not stats.month_contacts %}
            <div class="text-muted small">No data for this month.</div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>

  <!-- Employee List (table) -->
  <div class="row g-4">
    <div class="col-md-6">
      <div class="activity-card">
        <div class="activity-card-header">Employee List</div>

        <div class="activity-card-body">
          <div class="emp-table">
            <div class="emp-head">
              <div class="emp-col name">Name</div>
              <div class="emp-col num">Customers Added Totally</div>
              <div class="emp-col num">Customers Contacted Totally</div>
            </div>

            {% for e in stats.employee_list %}
              <div class="emp-row">
                <div class="emp-col name">{{ e.name }}</div>
                <div class="emp-col num">{{ e.customers_added_total }}</div>
                <div class="emp-col num">{{ e.customers_contacted_total }}</div>
              </div>
            {% endfor %}

            {% if not stats.employee_list %}
              <div class="text-muted small mt-2">No employees found.</div>
            {% endif %}
          </div>
        </div>

      </div>
    </div>
  </div>

</div>
{% endblock %}
